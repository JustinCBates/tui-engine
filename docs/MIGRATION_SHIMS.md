# Migration checklist and compatibility shims

This file provides a short migration checklist for consumers moving from the legacy Card/Section/Assembly API
to the new ContainerElement-based domain and documents a small compatibility shim approach for prompt-toolkit
versions that lack certain widgets (for example older prompt-toolkit releases without CheckboxList/RadioList).

## Goals

- Provide a clear, minimal migration checklist for library consumers.
- Offer a contained compatibility shim that the library can use internally to provide fallback widgets when
  a specific prompt-toolkit widget is unavailable at runtime.
- Keep the shim small and low-risk: it only supplies thin, well-documented fallbacks used inside `ptk_widget_factory`.

## Migration checklist (consumer-facing)

1. Replace `Card`, `Section`, or `Assembly` usage with `ContainerElement` and `Element` where appropriate.
   - Example: `Card(title, children=...)` -> `ContainerElement(title=..., children=[...])`.
2. If you depended on legacy rendering internals, switch to the `Page.render()` headless API for tests:
   - `page.get_render_lines()` remains the recommended deterministic surface for snapshot tests.
3. If you integrated custom keybindings or Application hooks, migrate to `ApplicationWrapper` DI hooks:
   - `set_real_app`, `set_key_bindings`, `register_widget_mapping`.
4. Update any import paths from `legacy_pkg.card` -> `tui_engine.container` or `tui_engine.page`.

## Compatibility shim approach (internal)

We provide a small shim module at `src/tui_engine/compat/ptk_shims.py` that exports helpers used by
`ptk_widget_factory` to obtain widgets. The shim attempts to import the real prompt-toolkit widgets.
If a widget is missing, it returns a small fallback implementation implementing the minimal API the
factory and adapters expect (selection state, value getters/setters, an `__ptk_repr__` sentinel).

Rules for shim fallback implementations:

- Do not import heavy dependencies; keep the fallback pure-python and minimal.
- Only implement methods used by our adapters (e.g., `.values`, `.current_value`, `.selected`, `.__ptk_repr__`).
- Document the fallback is not a full feature replacement â€” it's solely to keep library code paths intact
  and allow tests to run headlessly when older prompt-toolkit is present.

## Example: when to use

- In `ptk_widget_factory`, instead of `from prompt_toolkit.widgets import CheckboxList` use
  `from tui_engine.compat.ptk_shims import maybe_checkboxlist` and then call `maybe_checkboxlist(options)`.

## Next steps / PR checklist

- Add the shim module and update `ptk_widget_factory` to use shim helpers.
- Add tests that exercise the fallback behavior by temporarily removing prompt-toolkit or patching the shim import.
- Document in `docs/PTK_WIDGETS.md` that some environments may rely on fallbacks and recommend upgrading prompt-toolkit
  for best fidelity.

---
Generated by migration tooling on October 29, 2025.
